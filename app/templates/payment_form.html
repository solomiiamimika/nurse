<div class="payment-container">
    <h4>{{ _("Payment for:") }} {{ appointment.nurse_service.name }}</h4>
    <p>{{ _("Amount:") }} {{ "%.2f"|format(appointment.nurse_service.price) }} UAH</p>
    
    <button id="pay-button" class="btn btn-primary">
        <i class="fas fa-credit-card"></i> {{ _("Pay Now") }}
    </button>
</div>

<script src="https://js.stripe.com/v3/"></script>
<script>
document.addEventListener('DOMContentLoaded', function() {
    const stripe = Stripe('{{ config.STRIPE_PUBLIC_KEY }}');
    const payButton = document.getElementById('pay-button');
    
    payButton.addEventListener('click', function() {
        payButton.disabled = true;
        payButton.innerHTML = '<i class="fas fa-spinner fa-spin"></i> {{ _("Processing...") }}';
        
        fetch('/client/create_payment_session', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'X-CSRFToken': '{{ csrf_token() }}'
            },
            body: JSON.stringify({
                appointment_id: {{ appointment.id }}
            })
        })
        .then(response => {
            if (!response.ok) {
                throw new Error('{{ _("Network response was not ok") }}');
            }
            return response.json();
        })
        .then(data => {
            return stripe.redirectToCheckout({ sessionId: data.sessionId });
        })
        .then(result => {
            if (result.error) {
                payButton.disabled = false;
                payButton.innerHTML = '<i class="fas fa-credit-card"></i> {{ _("Pay Now") }}';
                alert(result.error.message);
            }
        })
        .catch(error => {
            console.error('Error:', error);
            payButton.disabled = false;
            payButton.innerHTML = '<i class="fas fa-credit-card"></i> {{ _("Pay Now") }}';
            alert('{{ _("Payment failed:") }} ' + error.message);
        });
    });
});
</script>

<style>
.payment-container {
    max-width: 500px;
    margin: 0 auto;
    padding: 20px;
    border: 1px solid #ddd;
    border-radius: 8px;
    background: white;
}
.btn {
    width: 100%;
    padding: 12px;
    margin-bottom: 10px;
}
</style>
